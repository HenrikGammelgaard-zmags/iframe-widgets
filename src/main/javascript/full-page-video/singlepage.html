<!DOCTYPE html>
<html>
    <head>
        <title>Test</title>
        <script src="http://code.jquery.com/jquery-2.0.0.min.js"></script>
        <link href="lib/video-js/video-js.css" rel="stylesheet">
        <script src="lib/video-js/video.js"></script>
        <script src="media.widget.js"></script>
        <script src="https://www.youtube.com/player_api"></script>
    </head>
    <body>
        <div id="ytplayer"></div>
        <div style="position: absolute; top: 80%; bottom: 0; left: 0; right: 0;">
            <div id="controls" class="vjs-default-skin"></div>
        </div>
        <script>
            // embed page

            function WidgetBus() {
                this.playerWidgets = {};
                this.callbacks = {};
            }

            WidgetBus.prototype.unregisterPlayerWidget = function (id) {
                this.playerWidgets[id] = null;
            };

            WidgetBus.prototype.offPlayerWidgetReady = function(id) {
                this.callbacks[id] = null;
            };

            WidgetBus.prototype.registerPlayerWidget = function (id, ytPlayerFactory) {
                if (this.callbacks[id]) {
                    this.callbacks[id](ytPlayerFactory);
                    this.offPlayerWidgetReady(id);
                } else {
                    this.playerWidgets[id] = ytPlayerFactory;
                }
            };

            WidgetBus.prototype.onPlayerWidgetReady = function (id, callback) {
                if (this.playerWidgets[id]) {
                    callback(this.playerWidgets[id]);
                    this.unregisterPlayerWidget(id);
                } else {
                    this.callbacks[id] = callback;
                }
            };

            var widgetBus = new WidgetBus();


            // controls widget

            // 2. On player widget ready
            widgetBus.onPlayerWidgetReady("x", function (ytPlayerFactory) {
                var ytPlayer = ytPlayerFactory();

                vjs("controls", {
                    techOrder: ["widget"],
                    width: "100%",
                    height: "100%",
                    ytPlayer: ytPlayer
                });
            });


            // player widget

            var queryParameters = (function () {
                var queryString = window.location.search,
                    output = {};

                if (queryString === "") {
                    return output;
                }

                var parameters = queryString.substr(1).split("&");
                for (var i = 0; i < parameters.length ; i++) {
                    var keyValue = parameters[i].split("=");
                    if (keyValue.length === 2) {
                        output[keyValue[0]] = decodeURIComponent(keyValue[1]);
                    } else {
                        output[keyValue[0]] = "";
                    }
                }

                return output;
            }());


            function createYtPlayer() {
                var ytPlayer = new YT.Player('ytplayer', {
                    height: 400,
                    width: 400,
                    videoId: "9bZkp7q19f0",//queryParameters.videoId,
                    // https://developers.google.com/youtube/player_parameters#Parameters
                    playerVars: {
                        controls: 0,
                        rel: 0,
                        showinfo: 0,
                        origin: window.location.origin
                    }
                });
                return ytPlayer;
            }

            // Somehow called by Youtube API code
            function onYouTubePlayerAPIReady() {
                // 1. register player widget ready
                widgetBus.registerPlayerWidget("x", createYtPlayer);
            }
        </script>
    </body>
</html>