<!DOCTYPE html>
<html>
    <head>
        <title>Widget with player</title>
        <script src="https://www.youtube.com/player_api"></script>
        <script src="WidgetBus.js"></script>
        <script>
            var queryParameters = (function () {
                var queryString = window.location.search,
                        output = {};

                if (queryString === "") {
                    return output;
                }

                var parameters = queryString.substr(1).split("&");
                for (var i = 0; i < parameters.length ; i++) {
                    var keyValue = parameters[i].split("=");
                    if (keyValue.length === 2) {
                        output[keyValue[0]] = decodeURIComponent(keyValue[1]);
                    } else {
                        output[keyValue[0]] = "";
                    }
                }

                return output;
            }());


            function createYtPlayer() {
                var ytPlayer = new YT.Player('ytplayer', {
                    height: window.innerHeight,
                    width: window.innerWidth,
                    videoId: queryParameters.videoId,
                    // https://developers.google.com/youtube/player_parameters#Parameters
                    playerVars: {
                        controls: 0,
                        rel: 0,
                        showinfo: 0,
                        origin: window.location.origin
                    }
                });

                window.onresize = function () {
                    ytPlayer.setSize(window.innerWidth, window.innerHeight);
                };

                ytPlayer.getIframe().frameBorder = "0";

                return ytPlayer;
            }

            // Somehow called by Youtube API code
            function onYouTubePlayerAPIReady() {
                var widgetBus = WidgetBus.initialize();
                widgetBus.registerPlayerWidget("x", createYtPlayer);
            }





            function isViewerAPIObject(obj) {
                return obj.setPublicationID;
            }

            function findViewerAPI() {
                var frame = window.parent.parent,
                    DEFAULT_NAME = "viewer";

                if (frame[DEFAULT_NAME] && isViewerAPIObject(frame[DEFAULT_NAME])) {
                    return frame[DEFAULT_NAME];
                } else if (frame.com && frame.com.zmags && frame.com.zmags.ps) {
                    return frame.com.zmags.ps.require("viewer").viewerAPI;
                } else {
                    for (var prop in frame) {
                        if (frame.hasOwnProperty(prop)) {
                            if (isViewerAPIObject(prop)) {
                                return prop;
                            }
                        }
                    }

                    return null;
                }

            }

            function blah(ytPlayer) {
                var viewerObj = findViewerAPI();

                if (viewerObj) {
                    viewerObj.addEventListener("customlinkactivate", function (event) {
                        var data = event.data;

                        if (data.type === "widget" && data.action === "play" && data.id === "x") {
                            if (ytPlayer.getPlayerState() === YT.PlayerState.PLAYING) {
                                ytPlayer.pauseVideo();
                            } else {
                                ytPlayer.playVideo();
                            }
                        }
                    });
                }
            }
        </script>
    </head>
    <body style="margin: 0;">
        <div id="ytplayer"></div>
    </body>
</html>