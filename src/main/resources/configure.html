<!DOCTYPE html>
<html>
    <head>
        <title>Widget configurator</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css" rel="stylesheet">
        <link href="//netdna.bootstrapcdn.com/font-awesome/3.1.1/css/font-awesome.min.css" rel="stylesheet">
        <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
        <!--<script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>-->

        <style type="text/css">
            #form {
                width: 30%;
                float: left;
            }

            #preview {
                width: 70%;
                float: left;
            }

            #preview iframe {
                width: 100%;
                height: 500px;
                outline: 1px solid lightgrey;
            }

            #url {
                width: 95%;
            }
        </style>
    </head>
    <body>
        <div id="form">
            <form>
                <fieldset id="widget-type">
                    <label>Type</label>
                    <select data-parameter="type">
                        <option value="text" selected>Text</option>
                        <option value="image">Image/SVG</option>
                    </select>
                </fieldset>

                <fieldset class="widget-config widget-config-text widget-config-image">
                    <legend>Animation</legend>
                    <label>Slide in from</label>
                    <select data-parameter="from">
                        <option value="" selected>Disabled</option>
                        <option value="top">Top</option>
                        <option value="bottom">Bottom</option>
                        <option value="left">Left</option>
                        <option value="right">Right</option>
                    </select>

                    <label>Duration</label>
                    <div class="input-append">
                        <input type="number" placeholder="1000" min="0" data-parameter="duration">
                        <span class="add-on">ms</span>
                    </div>

                    <label>Delay</label>
                    <div class="input-append">
                        <input type="number" placeholder="500" min="0" data-parameter="delay">
                        <span class="add-on">ms</span>
                    </div>
                </fieldset>

                <fieldset class="widget-config widget-config-text">
                    <legend>Text</legend>

                    <label>Text</label>
                    <textarea rows="3" data-parameter="text"></textarea>

                    <label>Font</label>
                    <input type="text" data-parameter="font-family">

                    <label>Google Font</label>
                    <input id="xyz" type="checkbox" data-parameter="googleFont">
                    <span class="help-block"><a href="https://www.google.com/fonts/" target="_blank">Google Fonts</a></span>


                </fieldset>

                <fieldset class="widget-config widget-config-image">
                    <legend>Image</legend>

                    <label>Source URL</label>
                    <input type="url" data-parameter="src">
                </fieldset>
            </form>
        </div>

        <div id="preview">
            <iframe id="preview-frame" frameborder="0"></iframe>
            <button id="refresh" class="btn"><i class="icon-refresh"></i></button>
            <a id="newwindow" class="btn" href="" target="_blank"><i class="icon-share"></i></a>
            <label>URL</label>
            <input id="url" type="text" readonly>
        </div>

        <script>
            // Ugly jQuery wrangling code ahead...

            var widgetType = $("#widget-type select"),
                update;

            function updateType() {
                $(".widget-config").hide();
                $(".widget-config-" + widgetType.val()).show();
            }

            function updateUrl() {
                clearTimeout(update);

                update = setTimeout(function () {
                    var parameters = [];

                    $("#widget-type, .widget-config-" + widgetType.val()).find("input, select, textarea").each(function (i, element) {
                        var e = $(element);

                        if (e.prop("type") === "checkbox" && e.prop("checked")) {
                            parameters.push(e.data("parameter") + "=true");
                        } else if (e.val() !== "") {
                            parameters.push(e.data("parameter") + "=" + encodeURIComponent(e.val()));
                        }
                    });

                    var url = "http://lugribossk.github.io/iframe-widgets/target/widget.html?" + parameters.join("&");

                    $("#preview-frame").prop("src", url + "&activate=true");
                    $("#newwindow").prop("href", url);
                    $("#url").val(url);
                }, 500);
            }

            $("#form").find("input, textarea").on("keyup", updateUrl);
            $("#form").find("input[type='checkbox'], select").on("change", updateUrl);

            $("#refresh").on("click", function () {
                $("#preview-frame").prop("src", $("#preview-frame").prop("src"));
            });

            $("#url").on("click", function () {
                this.select();
            });

            widgetType.on("change", updateType);

            updateType();
        </script>

        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-38789272-3', 'lugribossk.github.io');
            ga('send', 'pageview');
        </script>
    </body>
</html>